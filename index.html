<html>
  <head>
    <base href="/">
  </head>
  <body>
    <button style="width: 600px; height:200px" id="btn">click</button>
    <button style="width: 600px; height:200px" id="btn2">error</button>
    <ul>
      <li><a href="/">home</a></li>
      <li><a href="/foo">foo</a></li>
      <li><a href="/bar/123">bar</a></li>
    </ul>
    <main></main>
    <script type="module">
      import { Router } from './router.js';
      
      const router = new Router({
        plugins: [          
          {
            beforeNavigation: (context) => {
              context.title = `foo ${context.title}`
            }
          },
        ],
        fallback: '/404',
        routes: [
          {
            path: '/',
            title: 'Hello',
            render: () => 'home'
          },
          {
            path: '/foo',
            title: 'Foo',
            plugins: [
            ],
            render: () => 'foo'
          },
          {
            path: '/bar/:id',
            title: ({params}) => `Bar ${params.id}`,
            render: ({params}) => `bar ${params.id}`
          },
          {
            path: '/404',
            title: 'Not found',
            render: () => 'not found'
          },
        ]
      });

      router.addEventListener('route-changed', ({context}) => {
        const route = router.render();
        document.querySelector('main').innerHTML = route;
        console.log('Router: ', router, context);
      });
    </script>
    <script type="module">
      import { pwa } from './pwa.js';
      import { Api } from './api.js';
      import { abort } from './api/plugins/abort.js';
      import { logger } from './api/plugins/logger.js';
      import { debounce } from './api/plugins/debounce.js';
      import { xsrf } from './api/plugins/xsrf.js';

      // const d = debouncePlugin();

      // export const cache = cachePlugin();

      const api = new Api({plugins: [
        // abort,
        // xsrf,
        // logger,
        // debounce,
        // {
          // handleError: (e) => {
            // console.log('[inline plugin]:', e);
          // }
        // }
      ]});
      
      btn.addEventListener('click', async () => {
        try {
          api.get('https://pokeapi.co/api/v2/pokemon/1', { plugins: [debounce] }).then(() => { console.log(1)});
          api.get('https://pokeapi.co/api/v2/pokemon/2', { plugins: [debounce] }).then(() => { console.log(2)});
        } catch (e) {
          console.error('✅', e)
        }
      })

      btn2.addEventListener('click', async () => {
        try {
          await api.get('https://poasdfasdfkeapi.co/api/v2/pokemon/1');
        } catch(e) {
          console.log('11111 ✅', e);
        }
      })
    </script>
  </body>
</html>